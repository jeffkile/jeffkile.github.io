<meta charset="utf-8">

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.14.1/lodash.min.js"></script>
<script src="/assets/js/graph-scroll.js"></script>

<style>

path { 
    stroke: steelblue;
    stroke-width: 2;
    fill: none;
}

.axis path,
.axis line {
    fill: none;
    stroke: grey;
    stroke-width: 1;
    shape-rendering: crispEdges;
}

.tooltip {
  position: absolute;
  width: 200px;
  height: 28px;
  pointer-events: none;
}

.dot {
  cursor: pointer;
}

.stay-on-bottom { 
  position: fixed; 
  bottom:0%;
  width:100%; 
  background: white;
}

#scrollContainer {
  position: relative;
  overflow: auto;
}

#sections > div{
  opacity: .2
} 

#sections div.graph-scroll-active{
  opacity: 1;
}

#graph {
  background: white;
  z-index: 9;
}

#graph.graph-scroll-fixed {
  position: fixed;
  top: 0px;
}

#graph.graph-scroll-below {
  position: absolute;
  bottom: 0px;
}

</style>

<div id="scrollContainer">
  <div id="graph">
    <svg id="chart"></svg>
  </div>
  <div id="sections">
    <div>
      <h2>Day 1</h2>
      <p>We slept outside of the valley at a friends apartment in El Portal. We woke at 430am and almost burnt the
      place down trying to make coffee (turns out the kettle we used was an electric kettles that looked just like a real kettle but
       with a plastic bottom, oops). Despite the rough start we parked the car in the backpackers lot and made it up
       the steep 2k elevation gain to Little Yosemite Valley pretty quickly. Leaving before the sun was up made the
       hard climb more bearable. Vernal and Nevada were amazing.</p>
      <img src="yosemite valley"/>
    </div>
    <div>
      <br>
      <br>
      <br>
      <br>
    </div>
    <div>
      <br>
      <br>
      <br>
      <br>
    </div>
    <div>
      <p>We were so exhausted from waking up early, adjusting to the elevation and the hard morning climb that we
      ended up taking a lunch time nap in a burnt out part of the forest. This was second nature for John the Hot Shot
      fire fighter but it left us both looking like we had been on the trail much longer than one day.</p>
      <p>The bill of John's hat had "STOKED" written on it really big which encouraged a lot of people to stop and talk
      to us whic was great because we found out that our intended destination Sunrise Meadows was full of misquitos.
      So we decided to stay on a bluff near a stream before the final part of the climb into the meadow. We heard
      Clouds Rest is a great place to stop especially if you are doing a trip from Tolumne to the Valley but it
      was too far out of our way on this trip. Weather was perfect all day. </p>
      <img src="first night camp site"/>
    </div>
    <div>
      <h2>Day 2</h2>
      <p>Sunrise Meadow was beautiful but we had to almost run through it because the mosquitos were so bad. I felt bad
      for the people staying at the High Sierra camp.</p>
      <img src="sunrise meadow"/>
    </div>
    <div>
      <p>We ate lunch overlooking a giant granite valley. Where we made some friends with Martin and Adele from the
      Czech Republic. Martin is the CTO of Social Bakers a social analytics company where Adele also works. We were
      honored to be the first people to find out of their new engagement which happened just days before. They had just
      finished doing the JMT from Whitney to Tolumne and were now going from Yosemite Valley to Lake Tahoe.</p>
      <img src="john stoked"/>
      <img src="catedral pass selfie"/>
    </div>
    <div>
      <p>Cathedral Lake was spectacular. After enough people calling John "Stoked" it's clear this is his new trail
      name.</p>
      <img src="cathedral lake"/>
    </div>
    <div>
      <p>We made it to Tolumne Meadows despite being confused by the signs which made us think it was at first closer,
      than later farther then we thought. The store ended up being about 1.5 miles from the parking lot with the sign
      that says 3.5 miles to the High Sierra camp. The grill closed at 5pm but the store was open until 8pm so we were
      able to get some beers and sausages to cook on the fire at the Backpackers camp. This would also have been a
      great place to resupply had we planned that out ahead of time.</p>
    </div>
    <div>
      <h2>Day 3</h2>
      <br>
      <br>
      <br>
    </div>
    <div>
      <p>Jumped in the Lyle River on our way to Donahue Pass.</p>
      <img src="donahue pass with larz"></img>
    </div>
    <div>
      <p>We camped near the top of the Donahue Pass next to glacier lakes and water falls. Our site overlooked the
      valley and Lyle River below. Sunset was amazing and there were tons of stars out at night. I think this was the
      best campsite I've ever had.</p>
      <p>This is also where we met Larz and Steph a couple who we ended up hiking with most of the rest of the
      trail.</p>
      <img src="donahue pass valley">
      <img src="donahue pass campsite">
    </div>
    <div>
      <h2>Day 4</h2>
      <br>
      <br>
      <br>
    </div>
    <div>
      <p>Dogs are allowed on the trail from Reds Meadows up to Thousand Island Lakes.</p>
    </div>
    <div>
      <img src="thousand island lake">
    </div>
    <div>
      <p>We found a perfect campsite on the north shore of Garnette lake under a leaning tree between the lake and the
      trail. We ate lunch and took a nap here.</p>
      <img src="garnett lake">
    </div>
    <div>
      <br>
      <br>
      <br>
      <br>
    </div>
    <div>
      <p>Hiked with our new friends Larz and Steph down to shadow lake where they stopped. There were too many
      mosquitos there for us so we decided to try Rosalie lake which was up on top of some switch backs.</p>
    </div>
    <div>
      <p>Caught and ate our first trout at Rosalie Lake at a fishing spot John used to fish at with his Dad when he was a
      kid. We heard a bear harass every other campsite around the lake except for ours that night. Perhaps because ours
      was more in the open and harder for the bear to sneak into than the others.</p>
      <img src="rosalie camp site">
    </div>
    <div>
      <h2>Day 5</h2>
      <p>I had my first blister pop on the hike down to Reds Meadow which made it a pretty painful trek.</p>
    </div>
    <div>
      <p>Devils Postpile was cool. It's fascinating to think about how the rocks formed those unique symetrical curved
      square rods. The store at Reds Meadows has beer and is open until 7pm.</p>
    </div>
    <div>
      <h2>Day 6</h2>
      <p>We decided to take a "Zero Day" (trail slang for taking the day off) so that we could get some new supplies in
      Mammoth. The tram ride up from Reds Meadows cost $7 and takes about 45 minutes. In town I got a new pack (the
      Osprey 60L to replace the old external frame I was using that was starting to fall apart (John thought Brokepack
      Mountain was a pretty funny trail name for me, I eventually earned a better one). While in Mammoth we were able
      to catch the European Soccer Champship game, Portugal won. </p>
      <img src="osprey pack"><a>https://www.amazon.com/dp/B014EBRG5M/ref=twister_B019UTLLEK?_encoding=UTF8&psc=1</a>
      <p>That night we had a big fire at the backpacking camp where we encoutered our first "Trail Troll" (a term John
      came up with). a guy by the name of "Mover" who didn't seem like he moved very far. From what we could gather he
      just hung out the various backpacking camp living off what he could find in the hiker boxes and whatever weed he
      could sell to backpacker passing through. He said he had been "hiking" the PCT and the AT for the last 3
      years.</p>
    </div>
    <div>
      <h2>Day 7</h2>
      <p>The trail out of Reds Meadows didn't have the best views but was a great hiking trail. It was uphill, which I
      greatly prefer to downhill because its easier on my joints and I get a good workout; dirt, which is so much
      better than rock; and had ample shade. </p>
    </div>
    <div>
      <br>
      <br>
      <br>
    </div>
    <div>
      <p>There is every color wildflower imaginable along the trail.</p>
      <img src="wildflower pic?">
    </div>
    <div>
      <p>We took a break at Purple lake with Larz and Steph and our new friends Jeff and Dan. Jeff went to high school
      with John and we randomly ran into him camping next to us at Reds Meadows. Jeff's trail name is "Chef" because he
      brought the most delicious dehydrated dinners which he made himself. I think he got the recipes from this site:
      http://www.theyummylife.com/Instant_Meals_On_The_Go The Apricot Macadmia Nut Chicken Cous Cous was amazing. </p>
      <p>I went for a swim in the lake and Larz caught a fish.</p>
    </div>
    <div>
      <p>We camped at Virgina lake which is one of the most picturesque lakes I've ever seen. The way sunset lit up the
      mountains around the lake was incredible. It started to get cold when the sun goes down since were up above 11k
      feet now.</p>
      <img src="virgina lake day">
      <img src="virgina lake sunset">
    </div>
    <div>
    </div>
  </div>
</div>


<script>

// Name of location, miles from start, elevation
var data = [
  {
    name: 'Happy Isles',
    miles: 0,
    elevation: 4000
  },
  {
    name: 'Little Yosemite Valley',
    miles: 4,
    elevation: 6000
  },
  {
    name: 'Half Dome Trail',
    miles: 5,
    elevation: 7000
  },
  {
    name: 'First Nights Campsite',
    miles: 12,
    elevation: 8700
  },
  {
    name: 'Sunrise Camp',
    miles: 14,
    elevation: 9200
  },
  {
    name: 'Cathedral Pass',
    miles: 15.5,
    elevation: 9700
  },
  {
    name: 'Cathedral Lake',
    miles: 17.5,
    elevation: 9500
  },
  {
    name: 'Tuolumne Meadows',
    miles: 22.5,
    elevation: 8750
  },
  {
    name: 'Volgesang Pass Trail',
    miles: 30,
    elevation: 8900
  },
  {
    name: 'Lyell Fork Bridge',
    miles: 34,
    elevation: 9800
  },
  {
    name: 'Donohue Pass',
    miles: 37,
    elevation: 11500
  },
  {
    name: 'Rush Creek Trail',
    miles: 40,
    elevation: 9800
  },
  {
    name: 'Island Pass',
    miles: 42,
    elevation: 10200
  },
  {
    name: 'Thousand Island Lake',
    miles: 43,
    elevation: 9900
  },
  {
    name: 'Garnet Lake',
    miles: 45,
    elevation: 9800
  },
  {
    name: 'Ediza Lake Trail',
    miles: 47,
    elevation: 10000
  },
  {
    name: 'Shadow Creek Bridge',
    miles: 49,
    elevation: 8800
  },
  {
    name: 'Rosalie Lake',
    miles: 50,
    elevation: 9200
  },
  {
    name: 'Gladys Lake',
    miles: 51,
    elevation: 9400
  },
  {
    name: 'Devils Postpile',
    miles: 56,
    elevation: 7500
  },
  {
    name: 'Reds Meadow',
    miles: 57,
    elevation: 7600
  },
  {
    name: 'Deer Creek',
    miles: 62.5,
    elevation: 9200
  },
  {
    name: 'Duck Creek',
    miles: 67,
    elevation: 10000
  },
  {
    name: 'Purple Lake',
    miles: 71,
    elevation: 9900
  },
  {
    name: 'Lake Virginia',
    miles: 72,
    elevation: 10200
  },
  {
    name: 'Cascade Valley Trail',
    miles: 76,
    elevation: 9100
  },
  {
    name: 'Silver Pass',
    miles: 80,
    elevation: 10900
  },
  {
    name: 'Mono Pass Trail',
    miles: 85,
    elevation: 8300
  },
  {
    name: 'Mono Creek Bridge',
    miles: 87,
    elevation: 7700
  },
  {
    name: 'Bear Ridge',
    miles: 91,
    elevation: 9800
  },
  {
    name: 'Bear Creek Trail',
    miles: 93,
    elevation: 8800
  },
  {
    name: 'Marie Lake',
    miles: 98,
    elevation: 10500
  },
  {
    name: 'Seldon Pass',
    miles: 100.5,
    elevation: 10870
  },
  {
    name: 'Heart Lake',
    miles: 102,
    elevation: 10550
  },
  {
    name: 'Muir Trail Ranch',
    miles: 108,
    elevation: 7800
  },
  {
    name: 'South Fork San Joaquin Bridge',
    miles: 111,
    elevation: 8400
  },
  {
    name: 'Evolution Valley',
    miles: 115,
    elevation: 9200
  },
  {
    name: 'McClue Meadow',
    miles: 116,
    elevation: 9700
  },
  {
    name: 'Colby Meadow',
    miles: 118,
    elevation: 9800
  },
  {
    name: 'Evolution Lake',
    miles: 121,
    elevation: 10800
  },
  {
    name: 'Evolution Creek',
    miles: 125,
    elevation: 10300
  },
  {
    name: 'Muir Pass',
    miles: 128,
    elevation: 11955
  },
  {
    name: 'Bishop Pass Trail',
    miles: 135,
    elevation: 8800
  },
  {
    name: 'Palisade Creek',
    miles: 139.2,
    elevation: 8000
  },
  {
    name: 'Deer Meadow',
    miles: 142.7,
    elevation: 8800
  },
  {
    name: 'Golden Staircase',
    miles: 144,
    elevation: 10500
  },
  {
    name: 'Placer Lake',
    miles: 145.7,
    elevation: 10650,
  },
  {
    name: 'Mather Pass',
    miles: 150,
    elevation: 12080
  },
  {
    name: 'Taboose Pass Trail',
    miles: 155.1,
    elevation: 10000
  },
  {
    name: 'Bench Lake Trail',
    miles: 156.2,
    elevation: 11000
  },
  {
    name: 'Lake Marjoie',
    miles: 157.7,
    elevation: 11200
  },
  {
    name: 'Pinchot Pass',
    miles: 159.2,
    elevation: 12100
  },
  {
    name: 'Twin Lakes',
    miles: 162.3,
    elevation: 10560
  },
  {
    name: 'South Fork Trail',
    miles: 166.8,
    elevation: 8500
  },
  {
    name: 'Rae Lakes',
    miles: 172.3,
    elevation: 10500
  },
  {
    name: 'Glen Pass',
    miles: 175.6,
    elevation: 11980
  },
  {
    name: 'Kearsage Pass Trail',
    miles: 177.9,
    elevation: 10800
  },
  {
    name: 'Bubbs Creek Trail',
    miles: 180.1,
    elevation: 9600
  },
  {
    name: 'Center Basin Trail',
    miles: 183.6,
    elevation: 10500
  },
  {
    name: 'Forester Pass',
    miles: 187.1,
    elevation: 13200
  },
  {
    name: 'Shepherd Pass Trail',
    miles: 192.1,
    elevation: 10930
  },
  {
    name: 'Wallace Creek',
    miles: 199.1,
    elevation: 10400
  },
  {
    name: 'Crabtree Meadows Ranger Station',
    miles: 203.6,
    elevation: 10700
  },
  {
    name: 'Guitar Lake',
    miles: 205.7,
    elevation: 11600
  },
  {
    name: 'Mt Whitney Trail',
    miles: 209.6,
    elevation: 13500
  },
  {
    name: 'Mt Whitney',
    miles: 211.9,
    elevation: 14495
  },
  {
    name: 'Trail Crest',
    miles: 214.2,
    elevation: 13600
  },
  {
    name: 'Trail Camp',
    miles: 216.4,
    elevation: 12040
  },
  {
    name: 'Outpost Camp',
    miles: 219,
    elevation: 10600
  },
  {
    name: 'Lone Pine Lake',
    miles: 220,
    elevation: 9960
  },
  {
    name: 'Whitney Portal',
    miles: 222.4,
    elevation: 8360
  },
 ];

var margin = {left: 5, top: 5};
var width =  680;
var height = 250;

// Attach the mouses position to the window for 

var miles = _.map(data, 'miles');
var elevation = _.map(data, 'elevation');

var x = d3.scale.linear()
  .range([0, width])
  .domain([0, d3.max(miles)]);
var y = d3.scale.linear()
  .range([height, 0]) // height to 0 because we subtract from the upper right corner for svgs
  .domain([d3.min(elevation), d3.max(elevation)]);

// Define the line
var valueline = d3.svg.line()
    .x(function(d) { return x(d.miles); })
    .y(function(d) { return y(d.elevation); });

// Define the tooltip 
var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

var svg = d3.select("#chart")
    .attr("width", width + margin.left)
    .attr("height", height + margin.top)
    .append("g")
      .attr("transform", 
            "translate(" + margin.left + "," + margin.top + ")");

  svg.append("path")
    .attr("class", "line")
    .attr("d", valueline(data));

// Add the scatterplot
var updateDots = function(data) {
  console.log("updateDots", data.length);

  var selection = svg.selectAll(".dot").data(data);

  // Updates existing circles when data changes
  selection
    .transition()
    .duration(750)
    .attr("fill", function(d) {
      return d.active ? "red" : "black";
    })
    .attr("r", function(d) {
      return d.active ? 7 : 3;
    })
    .attr("opacity", function(d) {
      return d.active ? 1 : .5;
    });

  selection.enter().append("circle")
    .attr("class", "dot")
    .attr("r", 3)
    .attr("cx", function(d) { return x(d.miles); })
    .attr("cy", function(d) { return y(d.elevation); })
    .on("mouseover", function(d) {
      tooltip.transition()
        .duration(200)
        .style("opacity", .9);
      tooltip.html(d.name + "<br/>" +
          d3.format(",.2r")(d.miles) + " miles" + "<br/>" +
          d3.format(",.2r")(d.elevation) + " feet")
        .style("left", d3.event.pageX + "px")
        .style("top", d3.event.pageY + "px")
    })
    .on("mouseout", function(d) {
      tooltip.transition()
        .duration(500)
        .style("opacity", 0);
    });

  selection.exit().remove();


  return selection;
}

var dots = updateDots(data);

// Setup active events
var dispatch = d3.dispatch("activeSection");

dispatch.on('activeSection', function(index) {
  data = _.map(data, function(d) { 
    d.active = false;
    return d;
  });
  data[index].active = true;
  updateDots(data);
});

// Setup scrolling
graphScroll()
    .graph(d3.selectAll('#graph'))
    .container(d3.select('#scrollContainer'))
  .sections(d3.selectAll('#sections > div'))
  .on('active', function(i) {
    dispatch.activeSection(i);
    console.log(i + 'th section active');
  });

</script>
